{% extends 'base-espace-client.html.twig' %}

{% block title %}{{ title }}{% endblock %}

{% block body %}
    <div class="row mt-4">
        <div>
            <a class="btn  btn-large py-2 login" href="{{ path('app_espace_client_meeting_add') }}" role="button">Ajouter une réunion</a>
        </div>
    </div>
    <div class="row mt-5" id="list-meetings">
        <table class="table table-hover table-striped verticle-middle dataTable_meeting" id="dataTable_meeting">
            <thead>
                <tr>
                    <td class="encart_home_head text-green">Heure de début</td>
                    <th></th>
                    <td class="encart_home_head">Sujet</td>
                    {% if is_granted('ROLE_ADMIN') %}
                        <td class="encart_home_head text-center">Statut</td>
                    {% endif %}
                    <td class="encart_home_head">Lien de la réunion</td>
                    <th></th>
                </tr>
            </thead>
            <tbody>
            {% for row in meetings|reverse %}
                <tr id="meeting_{{ row.id }}">
                    <td>{{ row.date|date("d/m/yy") }} à  {{ row.date|date("H:i") }}</td>
                    <td><a class="detail_meeting" href="#" data-meeting="{{ row.id }}">+info</a></td>
                    <td>{{ row.subject }}</td>
                    {% if is_granted('ROLE_ADMIN') %}
                        <td class="text-center">
                            <span class="d-none">{{ row.status }}</span>
                            {% if row.status %}
                                <span data-toggle="tooltip" title="Réunion déjà faite!"><i class="fa fa-lock text-danger"></i></span>
                            {% else %}
                                <i class="fa fa-unlock-alt text-info "></i>
                            {% endif %}
                        </td>
                    {% endif %}
                    <td class="link_identifiant">
                        <span class="d-none">{{ row.link }}</span>
                        <input class="input_copy" type="text" id="linkInput_{{ row.id }}" value="{{ row.link }}" readonly>
                    </td>
                    <td>
                        <div class="actions link_identifiant">
                            <button class="btn-icon-right btn btn-danger encart_home_body"
                                    type="button"
                                    onclick="return copyToPaste({{ row.id }});"
                                    {{ row.status ? 'disabled="disabled"' : '' }}
                                    data-target="#link-meeting">
                                Copier lien <i class="fa fa-files-o" aria-hidden="true"></i>
                            </button>
{#                            <a href="{{ path('app_espace_client_meeting_edit', {'id':row.id}) }}"><i class="fa fa-cog" aria-hidden="true"></i></a>#}
                            <a href="#" data-meeting="{{ row.id }}" class="delete_meeting">
                                <i class="fa fa-trash text-danger" aria-hidden="true"></i>
                            </a>
                        </div>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <link href="{{ asset('build/css/toastr.min.css') }}" rel="stylesheet"/>
    <script src="{{ asset('build/js/toastr.min.js') }}"></script>
    <script>
        function copyToPaste(id) {
            var copyText = document.getElementById("linkInput_" + id);
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            document.execCommand("copy");

            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "2000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            };

            toastr["success"]("Lien de la réunion copié.")
        }
    </script>
{% endblock %}